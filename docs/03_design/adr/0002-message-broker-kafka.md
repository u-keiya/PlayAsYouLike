# ADR-0002: メッセージブローカーにApache Kafkaを採用する理由

## ステータス
Accepted

## 日付
2025-07-30

## コンテキスト
本システムでは、セッションイベントやエフェクト同期などのリアルタイム性・高スループットが求められる非同期通信基盤が必要である。  
複数のメッセージブローカー（Kafka, NATS, RabbitMQ等）が候補となった。

## 決定
メッセージブローカーとして **Apache Kafka** を採用する。

## 理由
- **高スループット・低レイテンシ**: 大量のイベントを安定して処理可能
- **パーティション単位の順序保証**: 音楽再生やエフェクト同期で順序性が重要
- **スケーラビリティ**: 水平分散構成が容易
- **エコシステム・運用知見**: OSSとして成熟しており、既存チームに知見あり
- **永続化・リプレイ**: イベントの保持・再送信が容易

## 影響範囲
- `class/infrastructure.puml` の EventBus
- `sequence/failover.puml` の冗長化設計
- `openapi.yaml` の設計方針

## 代替案
- **NATS**: 超低レイテンシだが順序保証・永続化要件に課題
- **RabbitMQ**: 柔軟なルーティングだが大規模分散・順序保証でKafkaに劣る

## トレーサビリティ
- #NF-01 可用性
## Consequences (追記)
- BeatmapSeedRepository は Kafka Topic 'seed-events' を使用してリプレイ保証を実現する (#ADR-0004)
- #US-002, #US-005 エフェクト同期・セッション管理
